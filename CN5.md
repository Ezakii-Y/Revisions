<!-- title: A test html -->

## CN5

==背诵==标志：✅。==易错==标志：🔨

#### 介质访问控制

介质访问控制的主要任务是为使用介质的每个节点隔离来自同一信道上其他节点所传送的信号，以协调活动节点。用于决定广播信道中信道分配的协议属于数据链路层的子层，称为**介质访问控制子层**(Medium Access Control, MAC)

#### 信道划分介质访问控制✅

**信道划分介质访问控制**将使用同一传输介质的多个设备的通信隔离开来，并合理地分配时域和频域资源，属于*静态划分信道*的方法。

**复用**指在发送端将信号组合在一条物理信道上传输，在接收端把收到地复用信号分离出来。

**时分复用(TDM)**将信道的传输时间划分为等长的时间片，称为TDM帧，每个用户在TDM帧中占用固定的时隙。所有用户在不同的时间占用同样的信道资源。

**统计时分复用(STDM)**，也称**异步时分复用**，动态分配时隙，当用户有数据要传送时，才会分配到STDM帧中的时隙。

**频分复用(FDM)**将信道的总频带划分为多个子频带，每个子频带作为一个子信道[^1]。

**波分复用(WDM)**即光的频分复用。

**码分复用(CDM)**是采用不同的编码来区分各路原始信号的复用方式。也称**码分多址(CDMA)**，原理是将比特时间划分为$m$[^2]个短时间槽，称为**码片(Chip)**，每个站点指派唯一的$m$位码片序列(伪随机噪声序列)，发送1时，站点发送码片序列；发送0时，站点发送码片序列的反码。各站点码片序列**相互正交**。

数据分离：想要知道A站发送的数据，用A站的码片序列与叠加信号作规格化内积，于是其他站的信号在内积结果中被过滤，只剩下A站的信号。

CDM主要用于无线通信系统，特别是**移动通信系统**。

#### 随机访问介质访问控制✅🔨

**总线型网络**中，多于两个用户同时发送信息时，会发生**帧冲突**，为解决此问题，每个用户需按一定规则反复重传数据帧，这些规则便是**随机访问介质访问控制协议**，也称争用型协议。

**纯ALOHA协议**
当总线型网络的任何站点发送数据时，可以不经任何检测发送。若一段时间内未收到确认，则认为发生冲突，站点等待随机一段时间重发。

**时隙ALOHA协议**
将时间划分为等长的时隙，规定站点只能在时隙开始时发送帧，发送一帧的时间必须小于等于时隙长度。冲突后重传的策略与纯ALOHA协议相似。

**CSMA协议**
*1-坚持CSMA*，站点要发送数据，首先监听信道：空闲，则发送；忙，则继续监听。
*非坚持CSMA*，站点要发送数据，首先监听信道：空闲，则发送；忙，放弃监听，等待一段随机时间再重新监听。此方法增加了数据在网络中的平均时延。
*p-坚持CSMA*，只适用于**时分信道**，站点要发送数据，首先监听信道：忙，继续监听[^3]；空闲，以$p$概率发送数据，以$1-p$概率推迟到下一个时隙。

**CSMA/CD协议**
载波监听多路访问/冲突检测协议为CSMA协议的改进方案，适用于总线型网络或半双工网络[^4]。站点在发送前需要监听信道，空闲时才能发送，边发送边检测信道上的电压变化情况，变化幅度超过一定门限值即表明发生了冲突。

本协议通常采用1-坚持CSMA方案。

站点发送数据后最多经过时间$2\tau$就可得知是否冲突，于是将以太网端到端往返传播时延$2\tau$称为**争用期**，或**冲突窗口**。

以太网规定了一个**最短帧长**，即争用期内可发送数据长度，凡是小于这个长度的帧，都是无效帧。计算公式为：最大单向传播时延$\times$数据传输速率$\times 2$。

以太网规定$51.2\nu s$为争用期长度，对于$10Mb/s$的以太网，争用期内可发送$512bit$即$64B$。若想发送小于$64B$的帧，需要在数据字段后面加一个整数字节的填充字段。

CSMA/CD协议采用**截断二进制指数退避算法**来确定冲突后的重传时机。过程如下：

1. 确定基本退避时间(一般为争用期$2\tau$)。
2. 从离散的整数集合$[0,1,...,(2^k-1)]$中随机取一个数$r$，重传推迟时间为$2r\tau$，$k=min[重传次数,10]$。
3. 当重传达16次仍不成功，抛弃此帧并向上层报错。

以太网还规定**帧间最小间隔**为$9.6\nu s$，相当于发送$96b$的时间[^5]。

协议归纳如下：

1. 准备发送：适配器从网络层获得一分组，封装成帧，放入适配器缓存。
2. 检测信道：若信道忙，则持续检测，直至空闲。若在帧间最小间隔(IFG)的时间内信道保持空闲，发送。
3. 发送过程中适配器持续检测信道，若发送失败：在争用期内检测到冲突，执行退避算法，等待一段随机时间后返回步骤2。若重传16次仍失败，停止重传并向上报错。

**CSMA/CA协议**
由于无线介质上信号强度的动态变化很大，因此实现冲突检测的硬件代价也很大，另外无线通信中存在“隐蔽站”问题[^6]。所以**802.11**标准定义了广泛用于无线局域网的CSMA/CA协议。

**802.11**标准采用**链路层确认/重传(ARQ)**方案，站点每发送完一帧，等收到确认帧后才能继续发送下一帧。可见，802.11标准采用的停止-等待协议是一种可靠传输协议。

802.11标准规定所有站检测到信道空闲后须等待一段很短的时间才能发送帧，称为**帧间间隔(IFS)**。有以下3种：

1. SIFS(短IFS)：最短的IFS，用于分隔属于一次对话的各帧，使用此IFS的帧类型有ACK帧、CTS帧、分片后的数据帧，以及所有回答AP探询的帧。
2. PIFS(点协调IFS)：中等长度IFS，在PCF方式下使用[^7]。
3. DIFS(分布式协调IFS)：最长的IFS，在DCF方式下用于发送数据帧和管理帧[^8]。

802.11标准规定各站采用**虚拟载波监听**机制，即让源站将它要占用信道的时间及时通知给所有其他站，此时所有其他站在被告知的时间内停止发送。

当且仅当检测到信道空闲且发送第一个数据帧时，不使用退避算法，否则使用如下的退避算法：

1. 设定争用窗口CW的初始值为$2^4-1=15$，第$i$次CW$=2^{4+i}-1$。
2. 第5次退避时达到最大值1023，往后不再增加。

退避算法触发条件为：

1. 站点在发送数据前检测到信道忙。
2. 站点发送数据后未收到ACK。
3. 站点发送后续数据帧。

协议归纳如下：

1. 若站点**最初**有数据要发送，且信道在DIFS内均为空闲，发送。
2. 否则，设置退避计时器，若信道忙，冻结此计时器；若信道空闲且在DIFS内均为空闲，开始争用信道，计时器解冻。若计时器归零，发送。
3. 收到确认后，转到2。若失败，也转2，但会在更大范围内选取随机数。

为了更好地解决隐蔽站问题，802.11允许发送站对信道进行预约。

1. 源站发送数据帧前，监听信道，若信道空闲，等待DIFS后，广播一个**请求发送RTS控制帧**，包括源地址，目的地址和这次通信所持续的时间。
2. 若AP正确收到RTS帧，且信道空闲，则等待SIFS后，广播**允许发送CTS控制帧**。
3. 源站收到CTS，再等待SIFS，发送数据帧。
4. 若AP正确收到源站发来的数据，等待SIFS后向源站发送ACK。

AP覆盖范围内地其他站听到CTS帧后，在CTS帧指明的时间内抑制发送。

RTS中的所需占用信道时间为：SIFS+CTS+SIFS+DATA+SIFS+ACK。

AP在CTS中所填写的所需占用信道时间为：SIFS+DATA+SIFS+ACK。

隐蔽站可根据CTS帧中的持续时间设置自己的**网络分配向量**[^9]。

#### 轮询访问：令牌传递协议

在此协议中，**令牌(token)**沿环形总线在各站依次传递，token不包含信息，是一种特殊的控制帧。站点只有取得令牌后才能发送帧。因此令牌环网络不会发生冲突。对所有联网计算机而言，访问权是公平的。

过程如下：

1. 网络空闲时，仅有令牌帧在环路中传递。
2. 当令牌传递到有数据要发送的站点时，站点修改令牌中的一个标志位，并附加上自己想传输的数据，此时令牌变成数据帧。
3. 数据帧沿环路传输，直到到达该帧的源站点，源站收到此帧后不再转发，同时检验该帧来查看数据传输过程是否出错，若出错，重传。
4. 源站点传送玩数据后，重新产生一个令牌，传递给下一个站点。

令牌传递协议适合负载很高的广播信道。


- [CN5](#cn5)
    - [介质访问控制](#介质访问控制)
    - [信道划分介质访问控制✅](#信道划分介质访问控制)
    - [随机访问介质访问控制✅🔨](#随机访问介质访问控制)
    - [轮询访问：令牌传递协议](#轮询访问令牌传递协议)

[^1]:相邻信道间还需加入“隔离频带”以防止互相干扰。
[^2]:通常取值为64或128。
[^3]:准确说是等到下一个时隙继续监听。
[^4]:全双工采用两条信道分别用来发送和接收。
[^5]:目的是使刚刚收到数据帧的接收站来得及清理缓存，为接受下一帧做好准备。
[^6]:使得冲突检测机制不能检测到所有冲突。
[^7]:PCF使用AP集中控制，以类似于探询的方式将发送权轮流交给各站，向上提供无争用服务。此为802.11的可选方式。
[^8]:DCF即为802.11的默认方式。
[^9]:即使没有收到CTS，源站在后续DATA帧的首部也会写明持续时间[DATA+SIFS+ACK]，隐蔽站可据此设置NAV。